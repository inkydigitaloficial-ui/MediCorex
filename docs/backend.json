{
  "entities": {
    "Tenant": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Tenant",
      "type": "object",
      "description": "Represents a tenant in the multi-tenant system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Tenant entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the tenant."
        },
        "domain": {
          "type": "string",
          "description": "The domain or subdomain associated with the tenant (e.g., tenantA.myapp.com)."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the tenant was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the tenant was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "name",
        "domain"
      ]
    },
    "CustomerInsight": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CustomerInsight",
      "type": "object",
      "description": "Represents customer insights generated by Genkit flows, specific to a tenant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the CustomerInsight entity."
        },
        "tenantId": {
          "type": "string",
          "description": "Reference to Tenant. (Relationship: Tenant 1:N CustomerInsight)"
        },
        "insightType": {
          "type": "string",
          "description": "The type of insight (e.g., 'user behavior', 'user attribute')."
        },
        "data": {
          "type": "string",
          "description": "JSON string containing the actual insight data."
        },
        "generatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the insight was generated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "tenantId",
        "insightType",
        "data"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "tenants/{tenantId}",
        "definition": {
          "entityName": "Tenant",
          "schema": {
            "$ref": "#/backend/entities/Tenant"
          },
          "description": "Stores tenant information.  Tenant ID is used as the document ID.",
          "params": [
            {
              "name": "tenantId",
              "description": "The unique identifier for the tenant."
            }
          ]
        }
      },
      {
        "path": "customer_insights/{customerInsightId}",
        "definition": {
          "entityName": "CustomerInsight",
          "schema": {
            "$ref": "#/backend/entities/CustomerInsight"
          },
          "description": "Stores customer insights generated by Genkit flows. Includes denormalized 'tenantId' for authorization independence.",
          "params": [
            {
              "name": "customerInsightId",
              "description": "The unique identifier for the customer insight."
            }
          ]
        }
      }
    ],
    "reasoning": "This design implements a multi-tenant system with secure data isolation and clear authorization. It leverages path-based ownership and denormalization to avoid `get()` calls in security rules, ensuring atomic operations and debuggability.  The structure enforces segregation by dedicating separate collections for tenant and customer insight data, maintaining homogeneous security postures within each collection.  Specifically, `customer_insights` collection stores tenant ID alongside the data for QAPs and tenant isolation."
  }
}